<form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="space-y-4 w-full">

  <!-- ── Nombre completo ─────────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Nombre completo <span class="text-red-500">*</span>
    </label>
    <input
      formControlName="name"
      type="text"
      placeholder="Juan Pérez"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
      [ngClass]="{
        'border-red-400 bg-red-50':   name?.invalid && name?.touched,
        'border-green-400 bg-green-50': name?.valid  && name?.touched,
        'border-neutral-300':          !name?.touched
      }"
    />
    <div *ngIf="name?.invalid && name?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="name?.errors?.['required']">El nombre es obligatorio</span>
      <span *ngIf="name?.errors?.['minlength']">Mínimo 3 caracteres</span>
      <span *ngIf="name?.errors?.['pattern']">Solo se permiten letras y espacios</span>
    </div>
  </div>

  <!-- ── Email ────────────────────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Correo electrónico <span class="text-red-500">*</span>
    </label>
    <input
      formControlName="email"
      type="email"
      placeholder="usuario@ejemplo.com"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
      [ngClass]="{
        'border-red-400 bg-red-50':    email?.invalid && email?.touched,
        'border-green-400 bg-green-50': email?.valid  && email?.touched,
        'border-neutral-300':           !email?.touched
      }"
    />
    <div *ngIf="email?.invalid && email?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="email?.errors?.['required']">El correo es obligatorio</span>
      <span *ngIf="email?.errors?.['email']">Ingresa un correo válido</span>
    </div>
  </div>

  <!-- ── Teléfono ──────────────────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Teléfono <span class="text-red-500">*</span>
    </label>
    <input
      formControlName="phone"
      type="tel"
      placeholder="3001234567"
      class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
      [ngClass]="{
        'border-red-400 bg-red-50':    phone?.invalid && phone?.touched,
        'border-green-400 bg-green-50': phone?.valid  && phone?.touched,
        'border-neutral-300':           !phone?.touched
      }"
    />
    <div *ngIf="phone?.invalid && phone?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="phone?.errors?.['required']">El teléfono es obligatorio</span>
      <span *ngIf="phone?.errors?.['pattern']">Ingresa un número colombiano válido (ej: 3001234567)</span>
    </div>
  </div>

  <!-- ── Fecha de nacimiento ───────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Fecha de nacimiento <span class="text-red-500">*</span>
    </label>
    <input
      formControlName="birthDate"
      type="date"
      class="w-full min-w-0 px-4 py-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition cursor-pointer"
      style="min-width: 100%;"
      [ngClass]="{
        'border-red-400 bg-red-50':    birthDate?.invalid && birthDate?.touched,
        'border-green-400 bg-green-50': birthDate?.valid  && birthDate?.touched,
        'border-neutral-300':           !birthDate?.touched
      }"
    />
    <div *ngIf="birthDate?.invalid && birthDate?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="birthDate?.errors?.['required']">La fecha de nacimiento es obligatoria</span>
      <span *ngIf="birthDate?.errors?.['menorDeEdad']">Debes ser mayor de 18 años para registrarte</span>
    </div>
  </div>

  <!-- ── Contraseña ────────────────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Contraseña <span class="text-red-500">*</span>
    </label>
    <div class="relative">
      <input
        formControlName="password"
        [type]="showPassword ? 'text' : 'password'"
        placeholder="Mínimo 8 caracteres"
        class="w-full px-4 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
        [ngClass]="{
          'border-red-400 bg-red-50':    password?.invalid && password?.touched,
          'border-green-400 bg-green-50': password?.valid  && password?.touched,
          'border-neutral-300':           !password?.touched
        }"
      />
      <button
        type="button"
        (click)="togglePassword()"
        class="absolute right-3 top-2.5 text-gray-500 hover:text-primary-500"
      >
        <app-icon [icon]="showPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></app-icon>
      </button>
    </div>
    <div *ngIf="password?.invalid && password?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="password?.errors?.['required']">La contraseña es obligatoria</span>
      <span *ngIf="password?.errors?.['minlength']">Mínimo 8 caracteres</span>
      <span *ngIf="password?.errors?.['passwordInsegura']">
        Debe incluir al menos: 1 mayúscula, 1 número y 1 carácter especial (!@#$...)
      </span>
    </div>
  </div>

  <!-- ── Confirmar contraseña ──────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-1">
      Confirmar contraseña <span class="text-red-500">*</span>
    </label>
    <div class="relative">
      <input
        formControlName="confirmPassword"
        [type]="showConfirmPassword ? 'text' : 'password'"
        placeholder="Repite tu contraseña"
        class="w-full px-4 py-2 pr-10 border rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 transition"
        [ngClass]="{
          'border-red-400 bg-red-50':    confirmPassword?.invalid && confirmPassword?.touched,
          'border-green-400 bg-green-50': confirmPassword?.valid  && confirmPassword?.touched,
          'border-neutral-300':           !confirmPassword?.touched
        }"
      />
      <button
        type="button"
        (click)="toggleConfirmPassword()"
        class="absolute right-3 top-2.5 text-gray-500 hover:text-primary-500"
      >
        <app-icon [icon]="showConfirmPassword ? 'fa-solid fa-eye-slash' : 'fa-solid fa-eye'"></app-icon>
      </button>
    </div>
    <div *ngIf="confirmPassword?.invalid && confirmPassword?.touched" class="mt-1 text-xs text-red-500">
      <span *ngIf="confirmPassword?.errors?.['required']">Confirma tu contraseña</span>
      <span *ngIf="confirmPassword?.errors?.['noCoinciden']">Las contraseñas no coinciden</span>
    </div>
  </div>

  <!-- ── Rol ───────────────────────────────────────────────────────── -->
  <div>
    <label class="block text-sm font-medium text-neutral-700 mb-2">
      Tipo de cuenta <span class="text-red-500">*</span>
    </label>
    <div class="grid grid-cols-2 gap-3">
      <!-- USUARIO -->
      <label
        class="flex flex-col items-center justify-center p-3 border-2 rounded-xl cursor-pointer transition"
        [ngClass]="{
          'border-primary-500 bg-primary-50 text-primary-700': role?.value === 'USUARIO',
          'border-neutral-200 hover:border-primary-300':       role?.value !== 'USUARIO'
        }"
      >
        <input type="radio" formControlName="role" value="USUARIO" class="hidden" />
        <app-icon icon="fa-solid fa-user" class="text-2xl mb-1"></app-icon>
        <span class="text-sm font-medium">Huésped</span>
        <span class="text-xs text-neutral-500 text-center">Buscar y reservar alojamientos</span>
      </label>

      <!-- ANFITRION -->
      <label
        class="flex flex-col items-center justify-center p-3 border-2 rounded-xl cursor-pointer transition"
        [ngClass]="{
          'border-primary-500 bg-primary-50 text-primary-700': role?.value === 'ANFITRION',
          'border-neutral-200 hover:border-primary-300':       role?.value !== 'ANFITRION'
        }"
      >
        <input type="radio" formControlName="role" value="ANFITRION" class="hidden" />
        <app-icon icon="fa-solid fa-house" class="text-2xl mb-1"></app-icon>
        <span class="text-sm font-medium">Anfitrión</span>
        <span class="text-xs text-neutral-500 text-center">Publicar y gestionar alojamientos</span>
      </label>
    </div>
  </div>

  <!-- ── Mensaje de error global ───────────────────────────────────── -->
  <div *ngIf="errorMessage" class="flex items-center gap-2 p-3 bg-red-50 border border-red-200 rounded-md">
    <app-icon icon="fa-solid fa-circle-exclamation" class="text-red-500"></app-icon>
    <span class="text-sm text-red-600">{{ errorMessage }}</span>
  </div>

  <!-- ── Botón submit ──────────────────────────────────────────────── -->
  <button
    type="submit"
    [disabled]="isLoading"
    class="w-full py-2 bg-primary-500 hover:bg-primary-600 text-white font-semibold rounded-md transition duration-200 flex items-center justify-center gap-2 disabled:opacity-60 disabled:cursor-not-allowed"
  >
    <app-icon *ngIf="isLoading" icon="fa-solid fa-spinner fa-spin"></app-icon>
    <span>{{ isLoading ? 'Registrando...' : 'Crear cuenta' }}</span>
  </button>

  <!-- ── Link a login ──────────────────────────────────────────────── -->
  <p class="text-center text-sm text-neutral-500 mt-2">
    ¿Ya tienes cuenta?
    <a routerLink="/login" class="text-primary-600 hover:underline font-medium">Inicia sesión</a>
  </p>

</form>